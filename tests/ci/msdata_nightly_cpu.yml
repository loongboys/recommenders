# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.
#

trigger: none

pr: none


jobs:

- job : Smoke
  displayName : 'Smoke: nightly_cpu_test'

  pool:
    vmImage: 'ubuntu-16.04'

  steps:

  - script:
      python ./scripts/generate_conda_file.py --name nightly_reco_base && \
      conda env create --quiet -f nightly_reco_base.yaml 2> log
    displayName: 'generate_conda_file.py'

  - script: 
      conda activate nightly_reco_base && \
      pytest tests/smoke -m "smoke and not spark and not gpu" --junitxml=reports/test-smoke.xml      
    displayName: 'smoke test'

  - task: PublishTestResults@2
      displayName: 'Publish Test Results **/test-*.xml'
      inputs:
        testResultsFiles: '**/test-*.xml'
        failTaskOnFailedTests: true
      condition: succeededOrFailed()
    displayName: 'publish'

- job : Integration
  displayName : 'Integration: nightly_cpu_test'
  dependsOn : Smoke
  timeoutInMinutes: 150
  condition: succeeded('Smoke')

  steps:

  - script:
      echo "done"
    displayName: 'Int'  
